{% extends 'library/base.html' %}

{% block content %}
    <h1>Библиотека</h1>
    
    <!-- ФОРМА ПОИСКА (Живой поиск) -->
    <div class="search-container">
        <input type="text" 
               name="q" 
               class="search-input"
               placeholder="Поиск по названию или автору..." 
               value="{{ search_query }}" 
               hx-get="{% url 'book_list' %}"
               hx-trigger="keyup changed delay:500ms"
               hx-target="#search-results"
               hx-push-url="true"
        >
        {% if search_query %}
            <a href="{% url 'book_list' %}" class="genre-filter-btn">Сбросить</a>
        {% endif %}
    </div>

    <!-- ФИЛЬТР ПО ЖАНРАМ -->
    <div style="margin-bottom: 25px; line-height: 2;">
        <strong style="margin-right: 10px;">Жанры:</strong>
        
        <a href="{% url 'book_list' %}" 
           class="genre-filter-btn {% if not current_genre_id %}active{% endif %}">
           Все
        </a>

        {% for genre in genres %}
            <a href="?genre={{ genre.id }}{% if search_query %}&q={{ search_query }}{% endif %}" 
               class="genre-filter-btn {% if current_genre_id == genre.id %}active{% endif %}">
               {{ genre.name }}
            </a>
        {% endfor %}
    </div>

    <hr style="border: 0; border-top: 1px solid #eee; margin-bottom: 20px;">

    <!-- РЕЗУЛЬТАТЫ -->
    <div id="search-results">
        {% include 'library/partials/book_list_partial.html' %}
    </div>

{% endblock %}